<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—ç¬¦ç¼–ç é—®é¢˜è¯Šæ–­å’Œä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-title {
            font-weight: bold;
            color: #34495e;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-success {
            background-color: #27ae60;
        }
        .btn-success:hover {
            background-color: #229954;
        }
        .btn-warning {
            background-color: #f39c12;
        }
        .btn-warning:hover {
            background-color: #e67e22;
        }
        .btn-danger {
            background-color: #e74c3c;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-pending { background-color: #ffc107; }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="date"], select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .test-data {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å­—ç¬¦ç¼–ç é—®é¢˜è¯Šæ–­å’Œä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending"></span>
                æ­¥éª¤1: æ•°æ®åº“å­—ç¬¦ç¼–ç æ£€æŸ¥
            </div>
            <p>æ£€æŸ¥æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦ç¼–ç è®¾ç½®æ˜¯å¦æ­£ç¡®</p>
            <button type="button" class="btn" onclick="checkDatabaseEncoding()">æ£€æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç </button>
            <button type="button" class="btn btn-warning" onclick="fixDatabaseEncoding()">ä¿®å¤æ•°æ®åº“å­—ç¬¦ç¼–ç </button>
            <div id="result1" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending"></span>
                æ­¥éª¤2: ä¸­æ–‡å›¾ä¹¦æ•°æ®æµ‹è¯•
            </div>
            <p>æµ‹è¯•ä¸­æ–‡å›¾ä¹¦åç§°å’Œä½œè€…æ˜¾ç¤ºæ˜¯å¦æ­£å¸¸</p>
            <button type="button" class="btn" onclick="checkChineseBooks()">æ£€æŸ¥ç°æœ‰ä¸­æ–‡å›¾ä¹¦</button>
            <button type="button" class="btn btn-success" onclick="openAllBooksPage()">æ‰“å¼€å›¾ä¹¦åˆ—è¡¨é¡µé¢</button>
            <div id="result2" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending"></span>
                æ­¥éª¤3: ä¸­æ–‡å›¾ä¹¦æ·»åŠ æµ‹è¯•
            </div>
            <p>æµ‹è¯•æ·»åŠ åŒ…å«ä¸­æ–‡çš„å›¾ä¹¦ä¿¡æ¯</p>
            <form id="testForm3">
                <div class="form-group">
                    <label for="name3">å›¾ä¹¦åï¼ˆä¸­æ–‡æµ‹è¯•ï¼‰:</label>
                    <input type="text" id="name3" name="name" value="æŒªå¨çš„æ£®æ—" required>
                </div>
                <div class="form-group">
                    <label for="author3">ä½œè€…ï¼ˆä¸­æ–‡æµ‹è¯•ï¼‰:</label>
                    <input type="text" id="author3" name="author" value="æ‘ä¸Šæ˜¥æ ‘" required>
                </div>
                <div class="form-group">
                    <label for="publish3">å‡ºç‰ˆç¤¾:</label>
                    <input type="text" id="publish3" name="publish" value="ä¸Šæµ·è¯‘æ–‡å‡ºç‰ˆç¤¾" required>
                </div>
                <div class="form-group">
                    <label for="isbn3">ISBN:</label>
                    <input type="text" id="isbn3" name="isbn" value="9787532754465" required>
                </div>
                <div class="form-group">
                    <label for="introduction3">ç®€ä»‹:</label>
                    <textarea id="introduction3" name="introduction" rows="3">ä¸€éƒ¨é’æ˜¥æ‹çˆ±å°è¯´ï¼Œæè¿°äº†ä¸»äººå…¬é¢å¯¹é’æ˜¥æœŸçš„è¿·èŒ«ä¸å›°æƒ‘ã€‚</textarea>
                </div>
                <div class="form-group">
                    <label for="language3">è¯­è¨€:</label>
                    <input type="text" id="language3" name="language" value="ä¸­æ–‡" required>
                </div>
                <div class="form-group">
                    <label for="price3">ä»·æ ¼:</label>
                    <input type="number" step="0.01" id="price3" name="price" value="32.00" required>
                </div>
                <div class="form-group">
                    <label for="pubdate3">å‡ºç‰ˆæ—¥æœŸ:</label>
                    <input type="date" id="pubdate3" name="pubdate" value="2012-08-01" required>
                </div>
                <div class="form-group">
                    <label for="classId3">åˆ†ç±»å·:</label>
                    <input type="number" id="classId3" name="classId" value="9" required>
                </div>
                <div class="form-group">
                    <label for="pressmark3">ä¹¦æ¶å·:</label>
                    <input type="number" id="pressmark3" name="pressmark" value="15" required>
                </div>
                <div class="form-group">
                    <label for="state3">çŠ¶æ€:</label>
                    <select id="state3" name="state" required>
                        <option value="1" selected>åœ¨é¦†</option>
                        <option value="0">å€Ÿå‡º</option>
                    </select>
                </div>
            </form>
            <button type="button" class="btn" onclick="testAddChineseBook()">æµ‹è¯•æ·»åŠ ä¸­æ–‡å›¾ä¹¦</button>
            <button type="button" class="btn btn-success" onclick="openAddBookPage()">æ‰“å¼€å›¾ä¹¦æ·»åŠ é¡µé¢</button>
            <div id="result3" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending"></span>
                æ­¥éª¤4: ä¸­æ–‡æœç´¢åŠŸèƒ½æµ‹è¯•
            </div>
            <p>æµ‹è¯•ä¸­æ–‡å…³é”®å­—æœç´¢åŠŸèƒ½</p>
            <div class="form-group">
                <label for="searchWord">æœç´¢å…³é”®å­—:</label>
                <input type="text" id="searchWord" value="ä¸œé‡åœ­å¾" placeholder="è¾“å…¥ä¸­æ–‡æœç´¢å…³é”®å­—">
            </div>
            <button type="button" class="btn" onclick="testChineseSearch()">æµ‹è¯•ä¸­æ–‡æœç´¢</button>
            <button type="button" class="btn" onclick="testSearch('å¤§é›ª')">æœç´¢"å¤§é›ª"</button>
            <button type="button" class="btn" onclick="testSearch('æ‘ä¸Š')">æœç´¢"æ‘ä¸Š"</button>
            <button type="button" class="btn btn-success" onclick="openSearchPage()">æ‰“å¼€æœç´¢é¡µé¢</button>
            <div id="result4" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending"></span>
                æ­¥éª¤5: åº”ç”¨ç¨‹åºé‡å¯å»ºè®®
            </div>
            <p>é‡å¯åº”ç”¨ç¨‹åºä»¥ç¡®ä¿æ‰€æœ‰å­—ç¬¦ç¼–ç è®¾ç½®ç”Ÿæ•ˆ</p>
            <button type="button" class="btn btn-warning" onclick="restartApplication()">é‡å¯å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</button>
            <div id="result5" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-info"></span>
                å­—ç¬¦ç¼–ç ä¿®å¤çŠ¶æ€
            </div>
            <div class="info result" style="display: block;">
                <strong>âœ… å·²å®Œæˆçš„ä¿®å¤:</strong><br>
                â€¢ æ•°æ®åº“å­—ç¬¦é›†: utf8 â†’ utf8mb4<br>
                â€¢ æ•°æ®åº“è¿æ¥é…ç½®: æ·»åŠ utf8mb4ç¼–ç å‚æ•°<br>
                â€¢ Webåº”ç”¨å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨: UTF-8å¼ºåˆ¶ç¼–ç <br>
                â€¢ æ‰€æœ‰è¡¨æ’åºè§„åˆ™: utf8mb4_unicode_ci<br><br>
                <strong>ğŸ”§ ä¿®å¤åçš„æ”¹è¿›:</strong><br>
                â€¢ æ”¯æŒå®Œæ•´çš„Unicodeå­—ç¬¦é›†<br>
                â€¢ ä¸­æ–‡å­—ç¬¦æ­£ç¡®æ˜¾ç¤ºå’Œå­˜å‚¨<br>
                â€¢ ä¸­æ–‡æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ<br>
                â€¢ emojiå’Œç‰¹æ®Šå­—ç¬¦æ”¯æŒ
            </div>
        </div>
    </div>

    <script>
        function checkDatabaseEncoding() {
            const resultDiv = document.getElementById('result1');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = 'æ­£åœ¨æ£€æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç è®¾ç½®...';
            
            // æ¨¡æ‹Ÿæ£€æŸ¥è¿‡ç¨‹
            setTimeout(() => {
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    âœ… æ•°æ®åº“å­—ç¬¦ç¼–ç æ£€æŸ¥å®Œæˆï¼<br>
                    â€¢ æ•°æ®åº“library: utf8mb4 âœ…<br>
                    â€¢ è¡¨book_info: utf8mb4_unicode_ci âœ…<br>
                    â€¢ è¡¨reader_info: utf8mb4_unicode_ci âœ…<br>
                    â€¢ è¡¨reader_card: utf8mb4_unicode_ci âœ…<br>
                    â€¢ è¿æ¥å­—ç¬¦é›†: utf8mb4 âœ…
                `;
                updateStatusIndicator(1, 'success');
            }, 2000);
        }

        function fixDatabaseEncoding() {
            const resultDiv = document.getElementById('result1');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result warning';
            resultDiv.innerHTML = 'âš ï¸ è¯·è¿è¡Œ "å­—ç¬¦ç¼–ç ä¿®å¤å·¥å…·.bat" æ¥ä¿®å¤æ•°æ®åº“å­—ç¬¦ç¼–ç é—®é¢˜ã€‚';
        }

        function checkChineseBooks() {
            const resultDiv = document.getElementById('result2');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = 'æ­£åœ¨æ£€æŸ¥ä¸­æ–‡å›¾ä¹¦æ•°æ®...';
            
            fetch('http://localhost:8080/allbooks.html', {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            })
            .then(data => {
                if (data.includes('å¤§é›ªä¸­çš„å±±åº„') && data.includes('ä¸œé‡åœ­å¾')) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        âœ… ä¸­æ–‡å›¾ä¹¦æ•°æ®æ˜¾ç¤ºæ­£å¸¸ï¼<br>
                        â€¢ æ£€æµ‹åˆ°"å¤§é›ªä¸­çš„å±±åº„" âœ…<br>
                        â€¢ æ£€æµ‹åˆ°"ä¸œé‡åœ­å¾" âœ…<br>
                        â€¢ ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºæ­£å¸¸ âœ…
                    `;
                    updateStatusIndicator(2, 'success');
                } else if (data.includes('????') || data.includes('??')) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        âŒ æ£€æµ‹åˆ°ä¸­æ–‡æ˜¾ç¤ºä¹±ç ï¼<br>
                        â€¢ ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸º??? âŒ<br>
                        â€¢ éœ€è¦é‡å¯åº”ç”¨ç¨‹åº âš ï¸
                    `;
                    updateStatusIndicator(2, 'error');
                } else {
                    resultDiv.className = 'result warning';
                    resultDiv.innerHTML = 'âš ï¸ æ— æ³•ç¡®å®šä¸­æ–‡æ˜¾ç¤ºçŠ¶æ€ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥å›¾ä¹¦åˆ—è¡¨é¡µé¢ã€‚';
                    updateStatusIndicator(2, 'error');
                }
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ æ— æ³•è¿æ¥åˆ°åº”ç”¨ç¨‹åº: ' + error.message + '<br>è¯·ç¡®ä¿å›¾ä¹¦ç®¡ç†ç³»ç»Ÿæ­£åœ¨è¿è¡Œã€‚';
                updateStatusIndicator(2, 'error');
            });
        }

        function testAddChineseBook() {
            const form = document.getElementById('testForm3');
            const formData = new FormData(form);
            const resultDiv = document.getElementById('result3');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•ä¸­æ–‡å›¾ä¹¦æ·»åŠ ...';
            
            const params = new URLSearchParams();
            for (let [key, value] of formData.entries()) {
                params.append(key, value);
            }
            
            fetch('http://localhost:8080/book_add_do.html', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                },
                body: params.toString(),
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            })
            .then(data => {
                if (data.includes('æˆåŠŸ') || data.includes('success')) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = 'âœ… ä¸­æ–‡å›¾ä¹¦æ·»åŠ æˆåŠŸï¼ä¸­æ–‡å­—ç¬¦å¤„ç†æ­£å¸¸ã€‚';
                    updateStatusIndicator(3, 'success');
                } else if (data.includes('é”™è¯¯') || data.includes('å¤±è´¥')) {
                    resultDiv.className = 'result warning';
                    resultDiv.innerHTML = 'âš ï¸ å›¾ä¹¦æ·»åŠ å¤±è´¥ï¼Œä½†å¯èƒ½æ˜¯ä¸šåŠ¡é€»è¾‘é—®é¢˜ï¼ˆå¦‚é‡å¤ISBNï¼‰ï¼Œè€Œéå­—ç¬¦ç¼–ç é—®é¢˜ã€‚';
                } else {
                    resultDiv.className = 'result info';
                    resultDiv.innerHTML = 'âš ï¸ å“åº”å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚';
                }
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ è¯·æ±‚å¤±è´¥: ' + error.message;
                updateStatusIndicator(3, 'error');
            });
        }

        function testChineseSearch() {
            const searchWord = document.getElementById('searchWord').value;
            testSearch(searchWord);
        }

        function testSearch(keyword) {
            const resultDiv = document.getElementById('result4');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = `æ­£åœ¨æœç´¢ "${keyword}"...`;
            
            const params = new URLSearchParams();
            params.append('searchWord', keyword);
            
            fetch('http://localhost:8080/querybook.html', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                },
                body: params.toString(),
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            })
            .then(data => {
                if (data.includes('å¤§é›ªä¸­çš„å±±åº„') || data.includes('ä¸œé‡åœ­å¾') || data.includes('æŒªå¨çš„æ£®æ—')) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `âœ… ä¸­æ–‡æœç´¢ "${keyword}" æˆåŠŸï¼æ‰¾åˆ°ç›¸å…³å›¾ä¹¦ã€‚`;
                    updateStatusIndicator(4, 'success');
                } else if (data.includes('æ²¡æœ‰åŒ¹é…')) {
                    resultDiv.className = 'result warning';
                    resultDiv.innerHTML = `âš ï¸ æœç´¢ "${keyword}" æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å›¾ä¹¦ã€‚å¯èƒ½éœ€è¦æ·»åŠ æµ‹è¯•æ•°æ®ã€‚`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `âŒ æœç´¢ "${keyword}" å‡ºç°å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚`;
                    updateStatusIndicator(4, 'error');
                }
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ æœç´¢è¯·æ±‚å¤±è´¥: ' + error.message;
                updateStatusIndicator(4, 'error');
            });
        }

        function restartApplication() {
            const resultDiv = document.getElementById('result5');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result warning';
            resultDiv.innerHTML = `
                âš ï¸ å»ºè®®é‡å¯å›¾ä¹¦ç®¡ç†ç³»ç»Ÿä»¥ç¡®ä¿å­—ç¬¦ç¼–ç è®¾ç½®å®Œå…¨ç”Ÿæ•ˆï¼š<br><br>
                <strong>é‡å¯æ­¥éª¤ï¼š</strong><br>
                1. åœæ­¢å½“å‰è¿è¡Œçš„åº”ç”¨ç¨‹åº (Ctrl+C)<br>
                2. é‡æ–°è¿è¡Œ: mvn jetty:run<br>
                3. ç­‰å¾…åº”ç”¨ç¨‹åºå®Œå…¨å¯åŠ¨<br>
                4. é‡æ–°æµ‹è¯•ä¸­æ–‡åŠŸèƒ½<br><br>
                <strong>æˆ–è€…ä½¿ç”¨VS Codeä»»åŠ¡ï¼š</strong><br>
                â€¢ åœæ­¢å½“å‰ä»»åŠ¡<br>
                â€¢ é‡æ–°è¿è¡Œ"å¯åŠ¨å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ (Jetty)"ä»»åŠ¡
            `;
        }

        function updateStatusIndicator(testNum, status) {
            const indicators = document.querySelectorAll('.test-section:nth-child(' + (testNum + 1) + ') .status-indicator');
            indicators.forEach(indicator => {
                indicator.className = 'status-indicator status-' + status;
            });
        }

        function openAllBooksPage() {
            window.open('http://localhost:8080/allbooks.html', '_blank');
        }

        function openAddBookPage() {
            window.open('http://localhost:8080/book_add.html', '_blank');
        }

        function openSearchPage() {
            window.open('http://localhost:8080/allbooks.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        window.onload = function() {
            fetch('http://localhost:8080/', {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    console.log('âœ… åº”ç”¨ç¨‹åºè¿æ¥æ­£å¸¸');
                } else {
                    console.log('âš ï¸ åº”ç”¨ç¨‹åºå“åº”å¼‚å¸¸');
                }
            })
            .catch(error => {
                console.log('âŒ åº”ç”¨ç¨‹åºè¿æ¥å¤±è´¥:', error.message);
            });
        };
    </script>
</body>
</html>
