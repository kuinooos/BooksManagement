<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP 405é”™è¯¯ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .test-button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background-color: #2980b9;
        }
        .success {
            background-color: #27ae60;
        }
        .error {
            background-color: #e74c3c;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success-result {
            background-color: #d5f4e6;
            color: #27ae60;
            border: 1px solid #27ae60;
        }
        .error-result {
            background-color: #fdf2f2;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        .info {
            background-color: #e8f4fd;
            color: #2980b9;
            border: 1px solid #2980b9;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 200px;
        }
        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }
        .status-success {
            background-color: #27ae60;
        }
        .status-error {
            background-color: #e74c3c;
        }
        .status-pending {
            background-color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HTTP 405é”™è¯¯ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ä¿®å¤æ¦‚è¿°</h2>
            <p><strong>é—®é¢˜ï¼š</strong>POSTè¯·æ±‚è¿”å›HTTP 405 Method Not Allowedé”™è¯¯</p>
            <p><strong>åŸå› ï¼š</strong>æ§åˆ¶å™¨æ–¹æ³•çš„@RequestMappingæ³¨è§£æ²¡æœ‰æ˜ç¡®æŒ‡å®šHTTPæ–¹æ³•</p>
            <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>ä¸ºæ‰€æœ‰å¤„ç†POSTè¯·æ±‚çš„æ–¹æ³•æ·»åŠ  <code>method = RequestMethod.POST</code></p>
        </div>

        <div class="test-section">
            <h2>å·²ä¿®å¤çš„POSTç«¯ç‚¹</h2>
            <div id="endpoints-status">
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-reader-add"></span>
                    <strong>reader_add_do.html</strong> - è¯»è€…æ·»åŠ åŠŸèƒ½
                    <button class="test-button" onclick="testReaderAdd()">æµ‹è¯•</button>
                    <div id="result-reader-add" class="result" style="display:none;"></div>
                </div>
                
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-book-add"></span>
                    <strong>book_add_do.html</strong> - å›¾ä¹¦æ·»åŠ åŠŸèƒ½
                    <button class="test-button" onclick="testBookAdd()">æµ‹è¯•</button>
                    <div id="result-book-add" class="result" style="display:none;"></div>
                </div>
                
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-book-edit"></span>
                    <strong>book_edit_do.html</strong> - å›¾ä¹¦ç¼–è¾‘åŠŸèƒ½
                    <button class="test-button" onclick="testBookEdit()">æµ‹è¯•</button>
                    <div id="result-book-edit" class="result" style="display:none;"></div>
                </div>
                
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-reader-edit"></span>
                    <strong>reader_edit_do.html</strong> - è¯»è€…ç¼–è¾‘åŠŸèƒ½
                    <button class="test-button" onclick="testReaderEdit()">æµ‹è¯•</button>
                    <div id="result-reader-edit" class="result" style="display:none;"></div>
                </div>
                
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-lend-book"></span>
                    <strong>lendbookdo.html</strong> - å€Ÿä¹¦åŠŸèƒ½
                    <button class="test-button" onclick="testLendBook()">æµ‹è¯•</button>
                    <div id="result-lend-book" class="result" style="display:none;"></div>
                </div>
                
                <div class="endpoint-item">
                    <span class="status-indicator status-pending" id="status-query-book"></span>
                    <strong>querybook.html</strong> - å›¾ä¹¦æœç´¢åŠŸèƒ½
                    <button class="test-button" onclick="testQueryBook()">æµ‹è¯•</button>
                    <div id="result-query-book" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>æ‰¹é‡æµ‹è¯•</h2>
            <button class="test-button" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button success" onclick="testLogin()">å…ˆç™»å½•</button>
            <div id="overall-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>å®é™…åŠŸèƒ½æµ‹è¯•</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è®¿é—®å®é™…åŠŸèƒ½é¡µé¢ï¼š</p>
            <button class="test-button" onclick="window.open('/login.html', '_blank')">ç™»å½•é¡µé¢</button>
            <button class="test-button" onclick="window.open('/reader_add.html', '_blank')">æ·»åŠ è¯»è€…</button>
            <button class="test-button" onclick="window.open('/book_add.html', '_blank')">æ·»åŠ å›¾ä¹¦</button>
            <button class="test-button" onclick="window.open('/allbooks.html', '_blank')">å›¾ä¹¦åˆ—è¡¨</button>
            <button class="test-button" onclick="window.open('/allreaders.html', '_blank')">è¯»è€…åˆ—è¡¨</button>
        </div>
    </div>

    <script>
        let sessionData = null;

        function updateStatus(endpointId, success, message) {
            const statusElement = document.getElementById(`status-${endpointId}`);
            const resultElement = document.getElementById(`result-${endpointId}`);
            
            if (success) {
                statusElement.className = 'status-indicator status-success';
                resultElement.className = 'result success-result';
                resultElement.textContent = 'âœ… ' + message;
            } else {
                statusElement.className = 'status-indicator status-error';
                resultElement.className = 'result error-result';
                resultElement.textContent = 'âŒ ' + message;
            }
            resultElement.style.display = 'block';
        }

        function testLogin() {
            const loginData = new FormData();
            loginData.append('id', '123');
            loginData.append('passwd', '123');

            fetch('/loginCheck', {
                method: 'POST',
                body: loginData
            })
            .then(response => response.json())
            .then(data => {
                if (data.stateCode === "1" || data.stateCode === "2") {
                    sessionData = data;
                    alert('ç™»å½•æˆåŠŸï¼å¯ä»¥å¼€å§‹æµ‹è¯•å…¶ä»–åŠŸèƒ½ã€‚');
                } else {
                    alert('ç™»å½•å¤±è´¥ï¼š' + data.msg);
                }
            })
            .catch(error => {
                console.error('ç™»å½•æµ‹è¯•å¤±è´¥:', error);
                alert('ç™»å½•è¯·æ±‚å¤±è´¥');
            });
        }

        function testReaderAdd() {
            const formData = new FormData();
            formData.append('readerId', '999');
            formData.append('name', 'æµ‹è¯•è¯»è€…');
            formData.append('sex', 'ç”·');
            formData.append('birth', '1990-01-01');
            formData.append('address', 'æµ‹è¯•åœ°å€');
            formData.append('telcode', '13800138000');

            fetch('/reader_add_do.html', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('reader-add', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('reader-add', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('reader-add', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('reader-add', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function testBookAdd() {
            const formData = new FormData();
            formData.append('name', 'æµ‹è¯•å›¾ä¹¦');
            formData.append('author', 'æµ‹è¯•ä½œè€…');
            formData.append('publish', 'æµ‹è¯•å‡ºç‰ˆç¤¾');
            formData.append('isbn', '1234567890123');
            formData.append('introduction', 'æµ‹è¯•ç®€ä»‹');
            formData.append('language', 'ä¸­æ–‡');
            formData.append('price', '29.99');
            formData.append('pubdate', '2023-01-01');
            formData.append('classId', '1');
            formData.append('pressmark', '1');
            formData.append('state', '1');

            fetch('/book_add_do.html', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('book-add', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('book-add', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('book-add', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('book-add', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function testBookEdit() {
            const formData = new FormData();
            formData.append('name', 'ç¼–è¾‘æµ‹è¯•å›¾ä¹¦');
            formData.append('author', 'ç¼–è¾‘æµ‹è¯•ä½œè€…');
            formData.append('publish', 'ç¼–è¾‘æµ‹è¯•å‡ºç‰ˆç¤¾');
            formData.append('isbn', '1234567890124');
            formData.append('introduction', 'ç¼–è¾‘æµ‹è¯•ç®€ä»‹');
            formData.append('language', 'ä¸­æ–‡');
            formData.append('price', '39.99');
            formData.append('pubdate', '2023-01-01');
            formData.append('classId', '1');
            formData.append('pressmark', '1');
            formData.append('state', '1');

            fetch('/book_edit_do.html?id=1', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('book-edit', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('book-edit', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('book-edit', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('book-edit', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function testReaderEdit() {
            const formData = new FormData();
            formData.append('name', 'ç¼–è¾‘æµ‹è¯•è¯»è€…');
            formData.append('sex', 'å¥³');
            formData.append('birth', '1992-01-01');
            formData.append('address', 'ç¼–è¾‘æµ‹è¯•åœ°å€');
            formData.append('telcode', '13900139000');

            fetch('/reader_edit_do.html?id=1', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('reader-edit', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('reader-edit', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('reader-edit', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('reader-edit', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function testLendBook() {
            const formData = new FormData();
            formData.append('readerId', '1');

            fetch('/lendbookdo.html?id=1', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('lend-book', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('lend-book', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('lend-book', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('lend-book', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function testQueryBook() {
            const formData = new FormData();
            formData.append('searchWord', 'æµ‹è¯•');

            fetch('/querybook.html', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.status === 405) {
                    updateStatus('query-book', false, 'HTTP 405é”™è¯¯ - ä¿®å¤å¤±è´¥');
                } else if (response.status === 302 || response.ok) {
                    updateStatus('query-book', true, 'è¯·æ±‚æˆåŠŸï¼Œæ²¡æœ‰405é”™è¯¯');
                } else {
                    updateStatus('query-book', false, `HTTP ${response.status}é”™è¯¯`);
                }
            })
            .catch(error => {
                updateStatus('query-book', false, 'è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }

        function runAllTests() {
            document.getElementById('overall-result').style.display = 'block';
            document.getElementById('overall-result').className = 'result info';
            document.getElementById('overall-result').textContent = 'ğŸ”„ æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...';
            
            const tests = [
                testReaderAdd,
                testBookAdd,
                testBookEdit,
                testReaderEdit,
                testLendBook,
                testQueryBook
            ];

            let delay = 0;
            tests.forEach(test => {
                setTimeout(test, delay);
                delay += 1000; // æ¯ä¸ªæµ‹è¯•é—´éš”1ç§’
            });

            setTimeout(() => {
                document.getElementById('overall-result').className = 'result success-result';
                document.getElementById('overall-result').textContent = 'âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆï¼æ£€æŸ¥ä¸Šé¢çš„ç»“æœã€‚';
            }, delay);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæç¤º
        window.onload = function() {
            console.log('HTTP 405é”™è¯¯ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('å»ºè®®å…ˆç‚¹å‡»"å…ˆç™»å½•"æŒ‰é’®ç™»å½•ç³»ç»Ÿï¼Œç„¶åå†æµ‹è¯•å…¶ä»–åŠŸèƒ½');
        };
    </script>
</body>
</html>
